<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}POS{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  {% block navbar %}
    <nav class="navbar">
      <div class="navbar-content">
        <a class="navbar-brand" href="#">My POS</a>
        <ul class="navbar-nav">
          <li><a href="/dashboard">แดชบอร์ด</a></li>
          <li><a href="/pos">ขายสินค้า</a></li>
          <li><a href="/products">สินค้า</a></li>
          <li><a href="/reports">รายงาน</a></li>
          <li><a href="/settings">ตั้งค่า</a></li>
        </ul>
        <div class="user-info">
            <span id="userName">ผู้เยี่ยมชม</span>
            <button class="login-btn" id="loginBtn" onclick="window.location.href='/login'" style="display: none;">เข้าสู่ระบบ</button>
            <button class="logout-btn" onclick="logout()" style="display: none;">ออกจากระบบ</button>
        </div>


      </div>
    </nav>
  {% endblock %}

  {% block content %}{% endblock %}

  <script>
  function updateUserUI(isLoggedIn, username = "ผู้เยี่ยมชม") {
    const userNameEl = document.getElementById("userName");
    const logoutBtn = document.querySelector(".logout-btn");
    const loginBtn = document.getElementById("loginBtn");

    userNameEl.innerText = username;

    if (isLoggedIn) {
      logoutBtn.style.display = "inline-block";
      loginBtn.style.display = "none";
    } else {
      logoutBtn.style.display = "none";
      loginBtn.style.display = "inline-block";
    }
  }

  const token = localStorage.getItem("access_token");

  if (token) {
    fetch('/api/auth/profile', {
      headers: { 'Authorization': 'Bearer ' + token }
    })
    .then(res => {
      if (!res.ok) throw new Error("Unauthorized");
      return res.json();
    })
    .then(data => {
      updateUserUI(true, data.user.username);
    })
    .catch(() => {
      updateUserUI(false);
    });
  } else {
    updateUserUI(false);
  }

  function logout() {
    localStorage.removeItem("access_token");
    updateUserUI(false);
    window.location.href = "/";
  }
</script>


  

  {% block script %}{% endblock %}
</body>
</html>
